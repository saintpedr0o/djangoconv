{% extends "converter/base.html" %}

{% block title %}Convert to {{output_format}}{% endblock %}

{% block content %}

<h3 class="convert-heading">Convert your {{ input_format }} file to {{ output_format }}</h3>

<form method="post" enctype="multipart/form-data" class="upload-form">
  {% csrf_token %}

  {% if form.non_field_errors %}
    <div class="form-errors">
      {% for error in form.non_field_errors %}
        <p class="error">{{ error }}</p>
      {% endfor %}
    </div>
  {% endif %}

  <div class="file-upload-wrapper">
    <div class="custom-file-button">
      <span class="file-label">üìÅ Choose file</span>
      {{ form.file }}

      {% if form.file.errors %}
        <div class="field-errors">
          {% for error in form.file.errors %}
            <p class="error">{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}

      <span class="file-selected-checkmark" aria-hidden="true" style="display: none;">‚úÖ</span>
    </div>
  </div>

  <div class="button-wrapper">
    <button type="submit" class="convert-button">Convert</button>
  </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const fileInput = document.querySelector('.custom-file-button input[type="file"]');
  const checkmark = document.querySelector('.file-selected-checkmark');
  const form = document.querySelector('.upload-form');

  if (!fileInput || !checkmark || !form) return;

  fileInput.addEventListener('change', function () {
    checkmark.style.display = fileInput.files.length > 0 ? 'inline' : 'none';
  });

  form.addEventListener('submit', function () {
    // Short delay to allow file to be sent before reset
    setTimeout(() => {
      form.reset();
      checkmark.style.display = 'none';
    }, 300);
  });
});
</script>

{%endblock%}